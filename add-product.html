<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Product</title>
    <link rel="stylesheet" href="styles.css" />
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        getFirestore,
        collection,
        doc,
        setDoc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDV7YHJA0cQiTqJXVWQP0IKjKUIellFz8E",
        authDomain: "fuzail-inventory.firebaseapp.com",
        projectId: "fuzail-inventory",
        storageBucket: "fuzail-inventory.firebasestorage.app",
        messagingSenderId: "92783887447",
        appId: "1:92783887447:web:e884309ae85e432d73cf12",
        measurementId: "G-354CVKGNWK",
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function addProduct(event) {
        event.preventDefault();

        const documentId = document.getElementById("documentId").value.trim();
        const name = document.getElementById("name").value;
        const category = document.getElementById("category").value;
        const description = document.getElementById("description").value;
        const detaileddescription = document.getElementById(
          "detaileddescription"
        ).value;
        const featured = document.getElementById("featured").checked;
        const image = `images/${document.getElementById("image").value.trim()}`;
        const images = document
          .getElementById("images")
          .value.split(",")
          .map((img) =>
            img.trim().startsWith("images/")
              ? img.trim()
              : `images/${img.trim()}`
          );
        const link = document.getElementById("link").value;

        try {
          const productsRef = collection(db, "products");
          const docRef = doc(productsRef, documentId);

          // Check if the document ID already exists
          const existingDoc = await getDoc(docRef);
          if (existingDoc.exists()) {
            const confirmUpdate = confirm(
              `Document with ID "${documentId}" already exists. Do you want to update it?`
            );
            if (!confirmUpdate) {
              alert("Operation canceled.");
              return;
            }
          }

          // Add or update the document
          await setDoc(docRef, {
            id: documentId, // Store the document ID for reference
            name,
            category,
            description,
            detaileddescription,
            featured,
            image,
            images,
            link,
          });

          alert(`Product added/updated successfully with ID: ${documentId}`);
          document.getElementById("product-form").reset();
        } catch (error) {
          console.error("Error adding product:", error);
          alert("Failed to add product. Please try again.");
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        document
          .getElementById("product-form")
          .addEventListener("submit", addProduct);
      });
    </script>
  </head>
  <style>
    /* General Styles */
    body {
      font-family: "Arial", sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    h2 {
      text-align: center;
      color: #333;
      margin-top: 20px;
      font-size: 2rem;
      font-weight: bold;
    }

    /* Form Styles */
    form {
      max-width: 600px;
      margin: 30px auto;
      background: #ffffff;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      animation: fadeIn 0.5s ease-in-out;
    }

    form label {
      display: block;
      font-size: 1rem;
      font-weight: bold;
      color: #555;
      margin-bottom: 8px;
      margin-top: 16px;
    }

    form input,
    form textarea,
    form button {
      width: 100%;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.3s ease;
    }

    form input:focus,
    form textarea:focus {
      border-color: #3a86ff;
      outline: none;
      box-shadow: 0 0 8px rgba(58, 134, 255, 0.3);
    }

    form textarea {
      resize: vertical;
      min-height: 80px;
    }

    form button {
      background: linear-gradient(135deg, #3a86ff, #006eff);
      color: #fff;
      font-weight: bold;
      margin-top: 20px;
      cursor: pointer;
      border: none;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      transition: transform 0.2s ease, background 0.3s ease-in-out;
    }

    form button:hover {
      background: linear-gradient(135deg, #0044cc, #0033a3);
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    /* Placeholder Styling */
    form input::placeholder,
    form textarea::placeholder {
      color: #aaa;
      font-style: italic;
    }

    /* Featured Checkbox */
    form input[type="checkbox"] {
      width: auto;
      margin-right: 10px;
    }

    form label[for="featured"] {
      display: inline-flex;
      align-items: center;
      font-weight: normal;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      form {
        padding: 15px 20px;
      }

      h2 {
        font-size: 1.8rem;
      }

      form button {
        font-size: 0.9rem;
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>

  <body>
    <h2>Add a New Product</h2>
    <form id="product-form">
      <label for="documentId">Document ID:</label>
      <input
        type="text"
        id="documentId"
        placeholder="Enter Document ID"
        required
      />

      <label for="name">Name:</label>
      <input type="text" id="name" placeholder="Enter product name" required />

      <label for="category">Category:</label>
      <input
        type="text"
        id="category"
        placeholder="Enter product category"
        required
      />

      <label for="description">Description:</label>
      <textarea
        id="description"
        placeholder="Enter product description"
        required
      ></textarea>

      <label for="detaileddescription">Detailed Description:</label>
      <textarea
        id="detaileddescription"
        placeholder="Enter detailed description"
        required
      ></textarea>

      <label for="featured">Featured:</label>
      <input type="checkbox" id="featured" />

      <label for="image">Image:</label>
      <input
        type="text"
        id="image"
        placeholder="Enter main image filename"
        required
      />

      <label for="images">Additional Images:</label>
      <input
        type="text"
        id="images"
        placeholder="Enter comma-separated filenames"
      />

      <label for="link">Link:</label>
      <input type="text" id="link" placeholder="Enter product link" />

      <button type="submit">Add Product</button>
    </form>
  </body>
</html>
